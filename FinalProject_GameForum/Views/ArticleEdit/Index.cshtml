@{
	Layout = "_LayoutTes";
}

<h1>文章編輯</h1>
<div class="container myContainer">
	<form id="editorForm" method="post" action="/ArticleEdit/SaveContent">
		<div class="row p-1">
			<label for="type">
				<h5>文章分類: </h5>
				<select name="type" class="selectArticleType">
					<option>AA</option>
					<option>AA</option>
					<option>AA</option>
					<option>AA</option>
				</select>
			</label>
		</div>
		<div class="row p-1">
			<label for="title">
				<h5>文章標題: </h5>
				<input type="text" name="title" class="w-100" />
			</label>
		</div>
		<div id="toolbar-container" class="toolbarContainer">
			<span class="ql-formats">
				<select class="ql-header">
					<option selected>文字</option>
					<option value="2">小標題</option>
					<option value="1">大標題</option>
				</select>
			</span>
			<span class="ql-formats">
				<select class="ql-font">
					<option selected></option>
					<option value="Arial">Arial</option>
					<option value="Helvetica">Helvetica</option>
					<option value="Verdana">Verdana</option>
					<option value="Times-New-Roman">Times New Roman</option>
					<option value="Georgia">Georgia</option>
					<option value="Courier-New">Courier New</option>
					<option value="Comic-Sans-MS">Comic Sans MS</option>
					<option value="Microsoft-JhengHei">微軟正黑體</option>
					<option value="PingFang-TC">蘋方體</option>
					<option value="DFKai-SB">標楷體</option>
					<option value="PMingLiU">新細明體</option>
					<option value="MingLiU">細明體</option>
				</select>
			</span>
			<span class="ql-formats">
				<select class="ql-size">
					<option value="small">小</option>
					<option selected>一般</option>
					<option value="large">大</option>
					<option value="huge">更大</option>
				</select>
			</span>
			<span class="ql-formats">
				<button class="ql-bold"></button>
				<button class="ql-italic"></button>
				<button class="ql-underline"></button>
				<button class="ql-strike"></button>
				<button class="ql-script" value="sub"></button>
				<button class="ql-script" value="super"></button>
			</span>
			<span class="ql-formats">
				<select class="ql-color"></select>
				<select class="ql-background"></select>
			</span>
			<span class="ql-formats">
				<button class="ql-blockquote"></button>
				<button class="ql-code-block"></button>
			</span>
			<span class="ql-formats">
				<button class="ql-list" value="ordered"></button>
				<button class="ql-list" value="bullet"></button>
				<button class="ql-hr">
					<span>
						<svg width="18" height="18" viewBox="0 0 18 18">
							<line x1="1" y1="9" x2="17" y2="9" stroke="black" stroke-width="2"></line>
						</svg>
					</span>
				</button>
			</span>
			<span class="ql-formats">
				<button class="ql-indent" value="-1"></button>
				<button class="ql-indent" value="+1"></button>
				<button class="ql-direction" value="rtl"></button>
				<select class="ql-align"></select>
			</span>
			<span class="ql-formats">
				<button class="ql-link"></button>
				<button class="ql-image"></button>
				<button class="ql-video"></button>
				<button class="ql-formula"></button>
			</span>
			<span class="ql-formats">
				<button class="ql-clean"></button>
			</span>
		</div>
		<div id="editor" class="editorBlock"></div>
		<textarea id="hiddenContent" name="content"></textarea>
		<div>
			<label for="imgFile">
				<div class="imgFile-border">
					<svg width="100" height="100" viewBox="0 0 100 100">
						<!-- 水平線 -->
						<line x1="20" y1="50" x2="80" y2="50" stroke="black" stroke-width="5" />
						<!-- 垂直線 -->
						<line x1="50" y1="20" x2="50" y2="80" stroke="black" stroke-width="5" />
					</svg>
				</div>
				<h5 class="m-1">上傳封面</h5>
			</label>
			<input type="file" id="imgFile" accept="image/gif, image/jpeg, image/png" />
		</div>
		<div class="m-2">
			<button type="button" class="submit-button" onclick="">儲存草稿</button>
			<button type="button" class="submit-button" onclick="submitForm()">發表文章</button>
		</div>
		<div id="imgFileBlock">
			<h5>圖片顯示: </h5>
			<img id="previewImg" style="width: 500px; margin-top: 10px;" />
		</div>
	</form>
</div>
<!-- Quill JS -->
<script src="~/lib/quill/quill.js"></script>
<script>
	var Font = Quill.import("formats/font");
	// 定義字體
	Font.whitelist = ["Arial", "Helvetica", "Verdana", "Times-New-Roman", "Georgia", "Courier-New", "Comic-Sans-MS",
					"Microsoft-JhengHei", "PingFang-TC", "DFKai-SB", "PMingLiU", "MingLiU"];
	Quill.register(Font, true);

	var quill = new Quill("#editor", {
	  theme: "snow",
	  modules: {
		toolbar: "#toolbar-container",
	  },
	});


	// 加入字體
	const style = document.createElement("style");
	style.innerHTML = `
	  .ql-font-Arial { font-family: "Arial"}
	  .ql-font-Helvetica { font-family: "Helvetica"}
	  .ql-font-Verdana { font-family: "Verdana"}
	  .ql-font-Times-New-Roman { font-family: "Times New Roman"}
	  .ql-font-Georgia { font-family: "Georgia"}
	  .ql-font-Courier-New { font-family: "Courier New"}
	  .ql-font-Comic-Sans-MS { font-family: "Comic Sans MS"}
	  .ql-font-Microsoft-JhengHei { font-family: "Microsoft JhengHei"}
	  .ql-font-PingFang-TC { font-family: "PingFang TC"}
	  .ql-font-DFKai-SB { font-family: "DFKai-SB"}
	  .ql-font-PMingLiU { font-family: "PMingLiU"}
	  .ql-font-MingLiU { font-family: "MingLiU"}
	`;
	document.head.appendChild(style);


	var BlockEmbed = Quill.import("blots/block/embed");

	class HrBlot extends BlockEmbed {
		static create() {
			let node = document.createElement("hr");
			return node;
		}
	}
	HrBlot.blotName = "hr";
	HrBlot.tagName = "hr";

	Quill.register(HrBlot); // 註冊 Blot

	var hrButton = document.querySelector(".ql-hr");
		hrButton.addEventListener("click", function() {
			var range = quill.getSelection();
			if (range) {
				quill.insertEmbed(range.index, "hr", true); // 插入水平線
			}
		});

	document.getElementById('imgFile').addEventListener('change', function(event) {
		const file = event.target.files[0]; // 取得選擇的檔案
			if (file) {
				const reader = new FileReader();
				reader.onload = function(e) {
					const previewImg = document.getElementById('previewImg');
					previewImg.src = e.target.result;
					imgFileBlock.style.display = 'block';
				};
				reader.readAsDataURL(file); // 讀取檔案內容並轉為 Base64
			}
	});


	// 提交表單時，把 Quill 內容轉換成 HTML 放入 textarea
	function submitForm() {
	  document.getElementById("hiddenContent").value = quill.root.innerHTML;
	  document.forms["editorForm"].submit();
	}
</script>